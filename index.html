<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revive with Sade Massage - Book Your Session</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-purple: #8B5A9F;
            --dark-purple: #6B4C7D;
            --light-purple: #B19CD9;
            --gold: #FFD700;
            --dark-gold: #E6C200;
            --black: #1a1a1a;
            --light-black: #2d2d2d;
            --white: #ffffff;
            --grey: #f8f8f8;
            --error: #ff4444;
            --success: #4CAF50;
        }

        body {
            font-family: 'Inter', Arial, sans-serif;
            background: linear-gradient(135deg, var(--black) 0%, var(--light-black) 50%, var(--dark-purple) 100%);
            color: var(--white);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            background: rgba(139, 90, 159, 0.1);
            border-radius: 20px;
            margin-bottom: 40px;
            border: 2px solid var(--gold);
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--gold), var(--light-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tagline {
            font-size: 1.2rem;
            color: var(--light-purple);
            font-weight: 300;
        }

        .booking-form {
            background: linear-gradient(145deg, rgba(139, 90, 159, 0.15), rgba(45, 45, 45, 0.8));
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border: 1px solid var(--gold);
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--gold);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-purple);
            padding-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            position: relative;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gold);
        }

        input, select, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--primary-purple);
            border-radius: 10px;
            background: rgba(26, 26, 26, 0.8);
            color: var(--white);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        select {
            cursor: pointer;
        }

        option {
            background: var(--light-black);
            color: var(--white);
        }

        .service-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .service-card {
            background: linear-gradient(145deg, var(--dark-purple), var(--primary-purple));
            padding: 25px;
            border-radius: 15px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .service-card:hover {
            transform: translateY(-5px);
            border-color: var(--gold);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        .service-card.selected {
            border-color: var(--gold);
            background: linear-gradient(145deg, var(--dark-gold), var(--gold));
            color: var(--black);
        }

        .service-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .service-duration {
            font-size: 1rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .service-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gold);
        }

        .service-card.selected .service-price {
            color: var(--black);
        }

        .calendar-container {
            margin: 20px 0;
        }

        .flatpickr-input {
            background: rgba(26, 26, 26, 0.8);
            color: var(--white);
            border: 2px solid var(--primary-purple);
        }

        .address-dropdown {
            display: none;
            margin-top: 10px;
        }

        .address-dropdown.show {
            display: block;
        }

        .price-display {
            background: linear-gradient(45deg, var(--gold), var(--dark-gold));
            color: var(--black);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, var(--gold), var(--dark-gold));
            color: var(--black);
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .success-message {
            background: var(--success);
            color: var(--white);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }

        .spinner {
            border: 4px solid var(--primary-purple);
            border-top: 4px solid var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            padding: 30px;
            color: var(--light-purple);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .logo {
                font-size: 2.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .booking-form {
                padding: 25px;
            }

            .service-options {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Flatpickr styling */
        .flatpickr-calendar {
            background: var(--light-black);
            border: 2px solid var(--primary-purple);
        }

        .flatpickr-month {
            background: var(--primary-purple);
            color: var(--white);
        }

        .flatpickr-day {
            color: var(--white);
        }

        .flatpickr-day:hover {
            background: var(--primary-purple);
            color: var(--white);
        }

        .flatpickr-day.selected {
            background: var(--gold);
            color: var(--black);
        }

        .flatpickr-day.disabled {
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="logo">Revive with Sade</h1>
            <p class="tagline">Premium Massage Therapy & Wellness</p>
        </div>

        <form class="booking-form" id="bookingForm">
            <!-- Personal Information -->
            <div class="form-section">
                <h2 class="section-title">Personal Information</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name *</label>
                        <input type="text" id="firstName" name="firstName" required>
                        <div class="error-message" id="firstNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name *</label>
                        <input type="text" id="lastName" name="lastName" required>
                        <div class="error-message" id="lastNameError"></div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" id="phone" name="phone" required>
                        <div class="error-message" id="phoneError"></div>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" name="email" required>
                        <div class="error-message" id="emailError"></div>
                    </div>
                </div>
            </div>

            <!-- Location Selection -->
            <div class="form-section">
                <h2 class="section-title">Location Preference</h2>
                <div class="form-group full-width">
                    <label for="locationType">Where would you like your massage? *</label>
                    <select id="locationType" name="locationType" required>
                        <option value="">Select Location Type</option>
                        <option value="destination">At Our Studio (Base Price)</option>
                        <option value="address">At Your Address (Mobile Service)</option>
                    </select>
                    <div class="error-message" id="locationTypeError"></div>
                </div>
                
                <div class="address-dropdown" id="addressSection">
                    <div class="form-group full-width">
                        <label for="clientAddress">Your Address *</label>
                        <textarea id="clientAddress" name="clientAddress" rows="3" placeholder="Please enter your full address"></textarea>
                        <div class="error-message" id="addressError"></div>
                    </div>
                </div>
            </div>

            <!-- Service Selection -->
            <div class="form-section">
                <h2 class="section-title">Choose Your Service</h2>
                <div class="service-options">
                    <div class="service-card" data-service="30min" data-price="500">
                        <div class="service-title">Relaxation Session</div>
                        <div class="service-duration">30 Minutes</div>
                        <div class="service-price">500 Le</div>
                    </div>
                    <div class="service-card" data-service="60min" data-price="1000">
                        <div class="service-title">Full Body Massage</div>
                        <div class="service-duration">60 Minutes</div>
                        <div class="service-price">1,000 Le</div>
                    </div>
                </div>
                <input type="hidden" id="selectedService" name="selectedService" required>
                <input type="hidden" id="servicePrice" name="servicePrice" required>
                <div class="error-message" id="serviceError"></div>
            </div>

            <!-- Date and Time Selection -->
            <div class="form-section">
                <h2 class="section-title">Select Date & Time</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookingDate">Preferred Date *</label>
                        <input type="text" id="bookingDate" name="bookingDate" placeholder="Select date" required>
                        <div class="error-message" id="dateError"></div>
                    </div>
                    <div class="form-group">
                        <label for="bookingTime">Preferred Time *</label>
                        <select id="bookingTime" name="bookingTime" required>
                            <option value="">Select Time</option>
                        </select>
                        <div class="error-message" id="timeError"></div>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
                <h2 class="section-title">Additional Information</h2>
                <div class="form-group full-width">
                    <label for="specialRequests">Special Requests or Health Considerations</label>
                    <textarea id="specialRequests" name="specialRequests" rows="4" placeholder="Please let us know about any allergies, injuries, or special preferences..."></textarea>
                </div>
            </div>

            <!-- Price Display -->
            <div class="price-display" id="priceDisplay" style="display: none;">
                Total: <span id="totalPrice">0</span> Le
            </div>

            <!-- Submit Button -->
            <button type="submit" class="submit-btn" id="submitBtn">Book Your Session</button>
            
            <div class="loading" id="loadingDiv">
                <div class="spinner"></div>
                <p>Sending your booking...</p>
            </div>
            
            <div class="success-message" id="successMessage">
                Your booking has been submitted successfully! You will receive a confirmation email shortly.
            </div>
        </form>

        <div class="footer">
            <p>&copy; 2025 Revive with Sade. Professional massage therapy services.</p>
            <p>Contact us: revivewithsade@gmail.com</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        // Initialize EmailJS
        emailjs.init("hCetBXhyuI4v5KKHr");

        // Global variables
        let selectedService = null;
        let selectedPrice = 0;
        let bookedSlots = JSON.parse(localStorage.getItem('bookedSlots') || '[]');
        let calendar = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeCalendar();
            initializeEventListeners();
            populateTimeSlots();
        });

        // Initialize calendar
        function initializeCalendar() {
            calendar = flatpickr("#bookingDate", {
                minDate: "today",
                maxDate: new Date().fp_incr(60),
                dateFormat: "Y-m-d",
                disable: [
                    function(date) {
                        return date.getDay() === 0;
                    }
                ],
                onChange: function(selectedDates) {
                    if (selectedDates.length > 0) {
                        updateAvailableTimeSlots(selectedDates[0]);
                    }
                }
            });
        }

        // Initialize event listeners
        function initializeEventListeners() {
            document.getElementById('locationType').addEventListener('change', function() {
                const addressSection = document.getElementById('addressSection');
                if (this.value === 'address') {
                    addressSection.classList.add('show');
                    document.getElementById('clientAddress').required = true;
                } else {
                    addressSection.classList.remove('show');
                    document.getElementById('clientAddress').required = false;
                }
                updatePricing();
            });

            document.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    selectedService = this.dataset.service;
                    selectedPrice = parseInt(this.dataset.price);
                    document.getElementById('selectedService').value = selectedService;
                    document.getElementById('servicePrice').value = selectedPrice;
                    
                    updatePricing();
                });
            });

            document.getElementById('bookingForm').addEventListener('submit', handleFormSubmission);
        }

        // Populate time slots
        function populateTimeSlots() {
            const timeSelect = document.getElementById('bookingTime');
            const times = [
                '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
                '12:00', '12:30', '13:00', '13:30', '14:00', '14:30',
                '15:00', '15:30', '16:00', '16:30', '17:00', '17:30',
                '18:00', '18:30', '19:00'
            ];

            timeSelect.innerHTML = '<option value="">Select Time</option>';
            times.forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = time;
                timeSelect.appendChild(option);
            });
        }

        // Update available time slots
        function updateAvailableTimeSlots(selectedDate) {
            const timeSelect = document.getElementById('bookingTime');
            const dateStr = selectedDate.toISOString().split('T')[0];
            
            const options = timeSelect.querySelectorAll('option');
            
            options.forEach(option => {
                if (option.value === '') return;
                
                const slotKey = `${dateStr}_${option.value}`;
                if (bookedSlots.includes(slotKey)) {
                    option.disabled = true;
                    option.textContent = `${option.value} (Booked)`;
                } else {
                    option.disabled = false;
                    option.textContent = option.value;
                }
            });
        }

        // Update pricing display
        function updatePricing() {
            const locationType = document.getElementById('locationType').value;
            const priceDisplay = document.getElementById('priceDisplay');
            const totalPriceElement = document.getElementById('totalPrice');

            if (selectedPrice > 0) {
                let finalPrice = selectedPrice;
                
                if (locationType === 'address') {
                    finalPrice = Math.round(selectedPrice * 1.5);
                }

                totalPriceElement.textContent = finalPrice.toLocaleString();
                priceDisplay.style.display = 'block';
            } else {
                priceDisplay.style.display = 'none';
            }
        }

        // Handle form submission
        function handleFormSubmission(e) {
            e.preventDefault();

            if (!validateForm()) {
                return;
            }

            const formData = new FormData(e.target);
            const bookingData = Object.fromEntries(formData.entries());
            
            bookingData.selectedDate = document.getElementById('bookingDate').value;
            bookingData.selectedTime = document.getElementById('bookingTime').value;
            bookingData.finalPrice = document.getElementById('totalPrice').textContent;

            document.getElementById('loadingDiv').style.display = 'block';
            document.getElementById('submitBtn').disabled = true;

            sendBookingEmail(bookingData);
        }

        // Validate form
        function validateForm() {
            let isValid = true;
            
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

            const requiredFields = ['firstName', 'lastName', 'phone', 'email', 'locationType', 'bookingDate', 'bookingTime'];
            
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                if (!element.value.trim()) {
                    document.getElementById(field + 'Error').textContent = 'This field is required';
                    isValid = false;
                }
            });

            if (!selectedService) {
                document.getElementById('serviceError').textContent = 'Please select a service';
                isValid = false;
            }

            if (document.getElementById('locationType').value === 'address' && 
                !document.getElementById('clientAddress').value.trim()) {
                document.getElementById('addressError').textContent = 'Please enter your address';
                isValid = false;
            }

            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailRegex.test(email)) {
                document.getElementById('emailError').textContent = 'Please enter a valid email address';
                isValid = false;
            }

            return isValid;
        }

        // Send booking email - CORRECTED VERSION
        function sendBookingEmail(bookingData) {
            // Service details mapping
            const serviceDetails = {
                "30min": { name: "Relaxation Session", duration: "30 Minutes" },
                "60min": { name: "Full Body Massage", duration: "60 Minutes" }
            };
            
            const serviceInfo = serviceDetails[bookingData.selectedService] || 
                               { name: bookingData.selectedService, duration: "Not specified" };
            
            const templateParams = {
                from_name: `${bookingData.firstName} ${bookingData.lastName}`,
                from_email: bookingData.email,
                phone: bookingData.phone,
                service_type: serviceInfo.name,
                duration: serviceInfo.duration,
                booking_date: bookingData.selectedDate,
                booking_time: bookingData.selectedTime,
                location: bookingData.locationType === 'address' ? 'Mobile Service' : 'Studio Location',
                address: bookingData.clientAddress || 'Studio Location',
                price: bookingData.finalPrice + ' Le',
                message: bookingData.specialRequests || 'None',
                referral_source: 'Website Booking Form',
                submission_date: new Date().toLocaleDateString() + ' at ' + new Date().toLocaleTimeString()
            };

            emailjs.send('service_1k6cw1r', 'template_hvr8mvc', templateParams)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    handleBookingSuccess(bookingData);
                }, function(error) {
                    console.log('FAILED...', error);
                    handleBookingError();
                });
        }

        // Handle successful booking
        function handleBookingSuccess(bookingData) {
            const slotKey = `${bookingData.selectedDate}_${bookingData.selectedTime}`;
            bookedSlots.push(slotKey);
            localStorage.setItem('bookedSlots', JSON.stringify(bookedSlots));

            document.getElementById('loadingDiv').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            
            document.getElementById('bookingForm').reset();
            document.querySelectorAll('.service-card').forEach(card => card.classList.remove('selected'));
            document.getElementById('priceDisplay').style.display = 'none';
            selectedService = null;
            selectedPrice = 0;
            
            setTimeout(() => {
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('successMessage').style.display = 'none';
            }, 5000);
        }

        // Handle booking error
        function handleBookingError() {
            document.getElementById('loadingDiv').style.display = 'none';
            document.getElementById('submitBtn').disabled = false;
            alert('There was an error sending your booking. Please try again or contact us directly.');
        }
    </script>
</body>
</html>
